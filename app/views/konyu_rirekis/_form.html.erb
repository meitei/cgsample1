<form id="konyuRirekiForm" method="post">
<input type="hidden" id="konyuRirekiId" name="konyu_rireki[konyuRirekiId]" value="<%= @konyu_rireki.konyuRirekiId %>" />
<input type="hidden" id="koshinshaId" name="konyu_rireki[koshinshaId]" value="<%= @konyu_rireki.koshinshaId %>" />
<input type="hidden" id="torokushaId" name="konyu_rireki[torokushaId]" value="<%= @konyu_rireki.torokushaId %>" />
<input type="hidden" id="httpMethod" name="_method" value="" />
<div>
  <table>
    <tr>
      <th style="width:100px;">顧客コード</th>
      <td style="width:250px;">
        <input style="width:100px;" type="text" id="kokyakuId" name="konyuRireki[kokyakuId]" value="<%= @konyu_rireki.kokyakuId %>" tabindex="10" />
      </td>
    </tr>
    <tr>
      <th style="width:100px;">氏名</th>
      <td style="width:200px;">
        <input style="width:100px;" type="text" id="kokyakuNm" name="konyuRireki[kokyakuNm]" value="<%= @konyu_rireki.kokyakuNm %>" tabindex="10" />
      </td>
    </tr>
    <tr>
      <th style="width:100px;">購入履歴コード</th>
      <td style="width:200px;">
        <input style="width:100px;" type="text" id="konyuRirekiId" name="konyuRireki[konyuRirekiId]" value="<%= @konyu_rireki.konyuRirekiId %>" tabindex="10" />
      </td>
      <th style="width:100px;">受付制作担当者</th>
      <td style="width:200px;">
        <input style="width:70px;" type="text" id="uketsukeSesakuTantoCd" name="konyuRireki[uketsukeSesakuTantoCd]" value="<%= @konyu_rireki.uketsukeSesakuTantoCd %>" tabindex="10" />
        <input style="width:70px;" type="text" id="uketsukeSesakuTantoNm" name="konyuRireki[uketsukeSesakuTantoNm]" value="<%= @konyu_rireki.uketsukeSesakuTantoNm %>" tabindex="10" />
      </td>
    </tr>
    <tr>
      <th>病院</th>
      <td>
        <input style="width:70px;" type="text" id="byoinCd" name="konyuRireki[byoinCd]" value="<%= @konyu_rireki.byoinCd %>" tabindex="10" />
        <input style="width:70px;" type="text" id="byoinNm" name="konyuRireki[byoinNm]" value="<%= @konyu_rireki.byoinNm %>" tabindex="10" />
      </td>
      <th>受注日</th>
      <td>
        <input style="width:80px;" type="text" id="juchuDt" name="konyu_rireki[juchuDt]" value="<%= @konyu_rireki.juchuDt %>" tabindex="12" />
      </td>
    </tr>
    <tr>
      <th>医師氏名</th>
      <td>
        <input style="width:70px;" type="text" id="ishiNm1" name="konyu_rireki[ishiNm1]" value="<%= @konyu_rireki.ishiNm1 %>" tabindex="12" />
        <input style="width:70px;" type="text" id="ishiNm2" name="konyu_rireki[ishiNm2]" value="<%= @konyu_rireki.ishiNm2 %>" tabindex="12" />
      </td>
      <th>仮合担当者</th>
      <td>
        <input style="width:70px;" type="text" id="kariAwaseTantoCd" name="konyuRireki[kariAwaseTantoCd]" value="<%= @konyu_rireki.kariAwaseTantoCd %>" tabindex="10" />
        <input style="width:70px;" type="text" id="kariAwaseTantoNm" name="konyuRireki[kariAwaseTantoNm]" value="<%= @konyu_rireki.kariAwaseTantoNm %>" tabindex="10" />
      </td>
    </tr>
    <tr>
      <th>理学療法士氏名</th>
      <td>
        <input style="width:70px;" type="text" id="rigakuRyohoNm1" name="konyu_rireki[rigakuRyohoNm1]" value="<%= @konyu_rireki.rigakuRyohoNm1 %>" tabindex="12" />
        <input style="width:70px;" type="text" id="rigakuRyohoNm2" name="konyu_rireki[rigakuRyohoNm2]" value="<%= @konyu_rireki.rigakuRyohoNm2 %>" tabindex="12" />
      </td>
      <th>仮合日</th>
      <td>
        <input style="width:80px;" type="text" id="kariAwaseDt" name="konyu_rireki[kariAwaseDt]" value="<%= @konyu_rireki.kariAwaseDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>作業療法士氏名</th>
      <td>
        <input style="width:70px;" type="text" id="rigakuRyohoNm1" name="konyu_rireki[rigakuRyohoNm1]" value="<%= @konyu_rireki.rigakuRyohoNm1 %>" tabindex="12" />
        <input style="width:70px;" type="text" id="rigakuRyohoNm2" name="konyu_rireki[rigakuRyohoNm2]" value="<%= @konyu_rireki.rigakuRyohoNm2 %>" tabindex="12" />
      </td>
      <th>納品担当者</th>
      <td>
        <input style="width:70px;" type="text" id="nohinTantoCd" name="konyu_rireki[nohinTantoCd]" value="<%= @konyu_rireki.nohinTantoCd %>" tabindex="12" />
        <input style="width:70px;" type="text" id="nohinTantoNm" name="konyu_rireki[nohinTantoNm]" value="<%= @konyu_rireki.nohinTantoNm %>" tabindex="12" />
      </td>
    </tr>
    <tr>
      <th>見積担当営業</th>
      <td>
        <input style="width:70px;" type="text" id="mitsumoriTantoEigyoCd" name="konyu_rireki[mitsumoriTantoEigyoCd]" value="<%= @konyu_rireki.mitsumoriTantoEigyoCd %>" tabindex="12" />
        <input style="width:70px;" type="text" id="mitsumoriTantoEigyoNm" name="konyu_rireki[mitsumoriTantoEigyoNm]" value="<%= @konyu_rireki.mitsumoriTantoEigyoNm %>" tabindex="12" />
      </td>
      <th>納品日</th>
      <td>
        <input style="width:80px;" type="text" id="nohinDt" name="konyu_rireki[nohinDt]" value="<%= @konyu_rireki.nohinDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>見積日</th>
      <td>
        <input style="width:80px;" type="text" id="mitsumoriDt" name="konyu_rireki[mitsumoriDt]" value="<%= @konyu_rireki.mitsumoriDt %>" tabindex="14" />
      </td>
      <th>交付日</th>
      <td>
        <input style="width:80px;" type="text" id="kofuDt" name="konyu_rireki[kofuDt]" value="<%= @konyu_rireki.kofuDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>種別</th>
      <td>
        <%= select :konyu_rireki, :shubetsuKn, [["新規", "0"], ["修理", "1"]], :include_blank => true, :style => "width:30px;" %>
      </td>
      <th>入金日</th>
      <td>
        <input style="width:80px;" type="text" id="nyukinDt" name="konyu_rireki[nyukinDt]" value="<%= @konyu_rireki.nyukinDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>見積製品項目</th>
      <td>
        <input style="width:70px;" type="text" id="seihinCd" name="konyu_rireki[seihinCd]" value="<%= @konyu_rireki.seihinCd %>" tabindex="12" />
        <input style="width:70px;" type="text" id="hinmeiNm" name="konyu_rireki[hinmeiNm]" value="<%= @konyu_rireki.hinmeiNm %>" tabindex="12" />
      </td>
      <th>押印日</th>
      <td>
        <input style="width:80px;" type="text" id="oshiinDt" name="konyu_rireki[oshiinDt]" value="<%= @konyu_rireki.oshiinDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>商品名</th>
      <td>
        <input style="width:130px;" type="text" id="shohinNm" name="konyu_rireki[shohinNm]" value="<%= @konyu_rireki.shohinNm %>" tabindex="14" />
      </td>
      <th>完了日</th>
      <td>
        <input style="width:80px;" type="text" id="kanryoDt" name="konyu_rireki[kanryoDt]" value="<%= @konyu_rireki.kanryoDt %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>保険種別1</th>
      <td>
      <!-- 保険種別マスタを表示 -->
        <%= select :konyu_rireki, :hokenShubetsuCd1, @hoken_shubetsu.map{|t| [t.hokenShubetsuNm, t.hokenShubetsuCd]}, :include_blank => true %>
      </td>
      <th>完成図</th>
      <!-- 完成図を表示する -->
      <td rowspan="4">
      </td>
    </tr>
    <tr>
      <th>保険種別2</th>
      <td>
        <!-- 保険種別マスタを表示 -->
        <%= select :konyu_rireki, :hokenShubetsuCd2, @hoken_shubetsu.map{|t| [t.hokenShubetsuNm, t.hokenShubetsuCd]}, :include_blank => true %>
      </td>
    </tr>
    <tr>
      <th>金額</th>
      <td>
        <input style="width:130px;" type="text" id="kin" name="konyu_rireki[kin]" value="<%= @konyu_rireki.kin %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>請求金額<br/>（負担額）</th>
      <td>
        <input style="width:130px;" type="text" id="seikyuKin" name="konyu_rireki[seikyuKin]" value="<%= @konyu_rireki.seikyuKin %>" tabindex="14" />
      </td>
    </tr>
    <tr>
      <th>商品仕様・備考</th>
      <td>
        <input style="width:130px;" type="text" id="shohinSiyoBiko" name="konyu_rireki[shohinSiyoBiko]" value="<%= @konyu_rireki.shohinSiyoBiko %>" tabindex="14" />
      </td>
    </tr>
  </table>
</div>
</form>
<script>
$(function() {
  $("#konyuRirekiForm").validate({
    errorClass:'error',
    errorElement:'label',
    highlight: function (element, errorClass, validClass) {
      $(element).addClass(errorClass);
    },
    unhighlight: function (element, errorClass, validClass) {
      $(element).removeClass(errorClass);
    },
    rules: {
        kokyakuId: {required:true},
        kokyakuNmKana: {katakana:true, maxlength:10},
        tanjoDt: {date:true},
        postNo: {postnum:true, maxlength:8},
        address1: {maxlength:100},
        address2: {maxlength:100},
        tel1: {telnum:true, maxlength:12},
        tel2: {mobilenum:true, maxlength:13},
        fax: {telnum:true, maxlength:12},
        gakkoNm: {maxlength:20},
        biko: {maxlength:100},
    }
  });
  $("#konyu_rireki_shubetsuKn").css("width", "100px").attr("tabindex", "6");
  $("#konyu_rireki_hokenShubetsuCd1").css("width", "100px").attr("tabindex", "6");
  $("#konyu_rireki_hokenShubetsuCd2").css("width", "100px").attr("tabindex", "6");
});

// 更新用メソッド
function executeKonyuRireki(kokyakuId) {
  // クライアントバリデーション
  if ($("#konyuRirekiForm").valid() == false) {
     return false;
  }
  //var action;
  //var method;
  if(kokyakuId != null) {
    $("#koshinshaId").val("1");
    $("#konyuRirekiForm").attr("action", "/kokyakus/" + kokyakuId);
    //$("#kokyakuForm").attr("method", "PUT");
    $("#httpMethod").val("put");
      //url = "../../kokyakus/" + kokyakuId + ".json";
      //type = "PUT";
  } else {
    $("#koshinshaId").val("1");
    $("#torokushaId").val("1");
      //url = "../kokyakus.json";
      //type = "POST";
    $("#konyuRirekiForm").attr("action", "/kokyakus");
    //$("#kokyakuForm").attr("method", "POST");
    $("#httpMethod").val("post");
  }
  $("#konyuRirekiForm").submit();
  // var data = {};
  // var postData = {};
  // var kokyaku = $("#kokyakuForm").serializeArray();
  // $.each(kokyaku, function() {
  //     data[this.name] = this.value;
  // });
  // data["koshinshaId"] = 1;
  // data["torokushaId"] = 1;
  // postData["kokyaku"] = data;
  // postData["id"] = kokyakuId;
  // $.ajax({
  //     scriptCharset:"UTF-8",
  //     type: type,
  //     url: url,
  //     data: postData,
  //     root: "kokyaku",
  //     dataType: "json",
  //     success: function(result) {
  //         if(result != null) {
  //             //searchKokyaku();
  //         }
  //     }
  // });
  return false;
}

</script>