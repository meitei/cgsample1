<form id="kokyakuForm" method="post">
<input type="hidden" id="kokyakuId" name="kokyaku[kokyakuId]" value="<%= @kokyaku.kokyakuId %>" />
<input type="hidden" id="koshinshaId" name="kokyaku[koshinshaId]" value="<%= @kokyaku.koshinshaId %>" />
<input type="hidden" id="torokushaId" name="kokyaku[torokushaId]" value="<%= @kokyaku.torokushaId %>" />
<input type="hidden" id="httpMethod" name="_method" value="" />
<div style="width:866px;">
  <table>
    <tr>
      <th style="width:75px;">顧客コード</th>
      <td style="width:205px;">
        <div id="kokyakuId" style="width:150px;" class="input-xlarge uneditable-input"><%= @kokyaku.kokyakuId %></div>
      </td>
      <th style="width:75px;">郵便番号</th>
      <td style="width:150px;">
        <input style="width:80px;" type="text" id="postNo" name="kokyaku[postNo]" value="<%= @kokyaku.postNo %>" tabindex="10" />
        <a id="searchAddress" href="#">住所表示</a>
      </td>
      <th style="width:100px;" scope="row">病名・障害名１</th>
      <td style="width:150px;">
        <%= select :kokyaku, :shobyouCd1, @shobyo.map{|t| [t.shobyoNm, t.shobyoCd]}, :include_blank => true %>
      </td>
    </tr>
    <tr>
      <th>顧客名称</th>
      <td>
        <input style="width:75px;" type="text" id="kokyakuNm1" name="kokyaku[kokyakuNm1]" value="<%= @kokyaku.kokyakuNm1 %>" tabindex="2" />
        <input style="width:75px;" type="text" id="kokyakuNm2" name="kokyaku[kokyakuNm2]" value="<%= @kokyaku.kokyakuNm2 %>" tabindex="2" />
      </td>
      <th>住所１</th>
      <td>
        <input style="width:150px;" type="text" id="address1" name="kokyaku[address1]" value="<%= @kokyaku.address1 %>" tabindex="12" />
      </td>
      <th>病名・障害名２</th>
      <td>
        <%= select :kokyaku, :shobyouCd2, @shobyo.map{|t| [t.shobyoNm, t.shobyoCd]}, :include_blank => true %>
      </td>
    </tr>
    <tr>
      <th>カナ名称</th>
      <td>
        <input style="width:75px;" type="text" id="kokyakuNmKana1" name="kokyaku[kokyakuNmKana1]" value="<%= @kokyaku.kokyakuNmKana1 %>" tabindex="4" />
        <input style="width:75px;" type="text" id="kokyakuNmKana2" name="kokyaku[kokyakuNmKana2]" value="<%= @kokyaku.kokyakuNmKana2 %>" tabindex="4" />
      </td>
      <th>住所２</th>
      <td>
        <input style="width:150px;" type="text" id="address2" name="kokyaku[address2]" value="<%= @kokyaku.address2 %>" tabindex="14" />
      </td>
      <th>病名・障害名３</th>
      <td>
        <%= select :kokyaku, :shobyouCd3, @shobyo.map{|t| [t.shobyoNm, t.shobyoCd]}, :include_blank => true %>
      </td>
    </tr>
    <tr>
      <th>性別</th>
      <td>
        <%= select :kokyaku, :seibetsu, [["男性", "0"], ["女性", "1"]], :include_blank => true %>
      </td>
      <th>電話番号</th>
      <td>
       <input style="width:150px;" type="text" id="tel1" name="kokyaku[tel1]" value="<%= @kokyaku.tel1 %>" tabindex="16" />
      </td>
      <th>学校名</th>
      <td>
        <input type="text" id="gakkoNm" name="kokyaku[gakkoNm]" value="<%= @kokyaku.gakkoNm %>" tabindex="28" />
      </td>
    </tr>
    <tr>
      <th>生年月日</th>
      <td>
        <%= select :kokyaku, :tanjoGengo, [["大正", "1"], ["昭和", "2"], ["平成", "3"]], :include_blank => true %>
        <input style="width:20px; ime-mode: disabled;" type="text" id="tanjoYear" name="kokyaku[tanjoYear]" value="<%= @kokyaku.tanjoYear %>" maxlength="2" tabindex="99" />年
        <input style="width:20px; ime-mode: disabled;" type="text" id="tanjoMonth" name="kokyaku[tanjoMonth]" value="<%= @kokyaku.tanjoMonth %>" maxlength="2" tabindex="99" />月
        <input style="width:20px; ime-mode: disabled;" type="text" id="tanjoDay" name="kokyaku[tanjoDay]" value="<%= @kokyaku.tanjoDay %>" maxlength="2" tabindex="99" />日
      </td>
      <th>携帯番号</th>
      <td>
        <input style="width:150px;" type="text" id="tel2" name="kokyaku[tel2]" value="<%= @kokyaku.tel2 %>" tabindex="18" />
      </td>
      <th></th>
      <td></td>
    </tr>
    <tr>
      <th></th>
      <td></td>
      <th>FAX番号</th>
      <td>
        <input style="width:150px;" type="text" id="fax" name="kokyaku[fax]" value="<%= @kokyaku.fax %>" tabindex="20" />
      </td>
      <th></th>
      <td></td>
    </tr>
    <tr>
      <th style="width:100px;">備考</th>
      <td colspan="5">
        <textarea style="width:500px;" id="biko" name="kokyaku[biko]" rows="3" cols="250" tabindex="30"><%= @kokyaku.biko %></textarea>
      </td>
    </tr>
  </table>
</div>
</form>

<script>
$(function() {
  $("#kokyakuForm").validate({
    errorClass:'error',
    errorElement:'label',
    highlight: function (element, errorClass, validClass) { 
      $(element).addClass(errorClass); 
    }, 
    unhighlight: function (element, errorClass, validClass) { 
      $(element).removeClass(errorClass); 
    },
    rules: {
        "kokyaku[kokyakuNm1]": {required:true, maxlength:10},
        "kokyaku[kokyakuNm2]": {required:true, maxlength:10},
        "kokyaku[kokyakuNmKana1]": {required:true, katakana:true, maxlength:10},
        "kokyaku[kokyakuNmKana2]": {required:true, katakana:true, maxlength:10},
        "kokyaku[tanjoYear]": {required:true, number:true, maxlength:2},
        "kokyaku[tanjoMonth]": {required:true, number:true, maxlength:2},
        "kokyaku[tanjoDay]": {required:true, number:true, maxlength:2},
        "kokyaku[postNo]": {required:true, postnum:true, maxlength:8},
        "kokyaku[address1]": {required:true, maxlength:100},
        "kokyaku[address2]": {maxlength:100},
        "kokyaku[tel1]": {required:true, telnum:true, maxlength:12},
        "kokyaku[tel2]": {required:true, mobilenum:true, maxlength:13},
        "kokyaku[fax]": {telnum:true, maxlength:12},
        "kokyaku[shobyouCd1]": {required:true},
        "kokyaku[gakkoNm]": {maxlength:20},
        "kokyaku[biko]": {maxlength:100}
    }
  });

  $("a#searchAddress").click(function() {
    var zipCode = $("#postNo").val();
    if(zipCode == "") { return false; }
    var url = "http://api.postalcode.jp/v1/zipsearch?zipcode=" + zipCode + "&callback=callback1";
    $.ajax({
      scriptCharset:"UTF-8",
      type: "GET",
      url: url,
      dataType: "jsonp",
      success: function(data) {
        var address = data.zipcode;
        $("#address1").val(address.a1.city + address.a1.town);
      }
    });
    return false;
  });
  $("#kokyaku_seibetsu").css("width", "100px").attr("tabindex", "6");
  $("#kokyaku_tanjoGengo").css("width", "60px").attr("tabindex", "99"); //TODO:tabindex
  $("#kokyaku_shobyouCd1").css("width", "100px").attr("tabindex", "22");
  $("#kokyaku_shobyouCd2").css("width", "100px").attr("tabindex", "24");
  $("#kokyaku_shobyouCd3").css("width", "100px").attr("tabindex", "26");
});

// Submit前処理用メソッド
function executeKokyaku() {
  // クライアントバリデーション
  if ($("#kokyakuForm").valid() == false) {
     return false;
  }
  var kokyakuId = $("#kokyakuId").val();
  //var action;
  //var method;
  if(kokyakuId != null && kokyakuId != undefined && kokyakuId != "") {
    $("#koshinshaId").val($("#loginId").val());
    $("#kokyakuForm").attr("action", "/kokyakus/" + kokyakuId);
    $("#httpMethod").val("put");
  } else {
    $("#koshinshaId").val($("#loginId").val());
    $("#torokushaId").val($("#loginId").val());
    $("#kokyakuForm").attr("action", "/kokyakus");
    $("#httpMethod").val("post");
  }
  $("#kokyakuForm").submit();
  return false;
}

function callback1( data ) {
  var address = data["city"];
  $("#address1").val(address);
}

</script>